<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control - Auto-Fill System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        h1 { color: #333; margin-bottom: 30px; text-align: center; }
        h2 { color: #444; margin: 25px 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #007bff; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        
        .switch-group { display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 10px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #28a745; }
        input:checked + .slider:before { transform: translateX(24px); }
        
        .button-group { display: flex; gap: 10px; margin-top: 30px; }
        button { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; flex: 1; }
        .btn-save { background: #007bff; color: white; }
        .btn-save:hover { background: #0069d9; }
        .btn-broadcast { background: #28a745; color: white; }
        .btn-broadcast:hover { background: #218838; }
        .btn-reset { background: #ffc107; color: #333; }
        .btn-reset:hover { background: #e0a800; }
        
        .status { padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center; font-weight: bold; }
        .online { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .offline { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 5px; color: white; z-index: 1000; animation: slideIn 0.3s; }
        .success { background: #28a745; }
        .error { background: #dc3545; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Auto-Fill System Admin</h1>
        
        <div class="status offline" id="statusBox">
            <span id="statusText">Connecting to server...</span>
        </div>
        
        <h2>üìù Default Values</h2>
        <p style="color: #666; margin-bottom: 20px; font-size: 14px;">These values will auto-fill in user forms</p>
        
        <div class="form-group">
            <label>Bulk Transit Pass No:</label>
            <input type="text" id="input-bulk" placeholder="THNSY250001534" value="THNSY250001534">
        </div>
        
        <div class="form-group">
            <label>Security Paper Serial No:</label>
            <input type="text" id="input-security" placeholder="TSPS01907125" value="TSPS01907125">
        </div>
        
        <div class="form-group">
            <label>Transit Pass Serial No:</label>
            <input type="text" id="input-transit" placeholder="THN000000056770/2025" value="THN000000056770/2025">
        </div>
        
        <h2>üîí Field Locking</h2>
        <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Locked fields cannot be edited by users</p>
        
        <div class="switch-group">
            <span>Lock Bulk Transit Field</span>
            <label class="switch">
                <input type="checkbox" id="lock-bulk" checked>
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="switch-group">
            <span>Lock Security Paper Field</span>
            <label class="switch">
                <input type="checkbox" id="lock-security" checked>
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="switch-group">
            <span>Lock Transit Pass Field</span>
            <label class="switch">
                <input type="checkbox" id="lock-transit" checked>
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="button-group">
            <button class="btn-save" onclick="saveAllSettings()">üíæ Save & Broadcast</button>
            <button class="btn-reset" onclick="resetToDefault()">üîÑ Reset Defaults</button>
        </div>
        
</div>
    
    <div id="notificationContainer"></div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        const DEFAULT_VALUES = {
            bulkTransit: 'THNSY250001534',
            security: 'TSPS01907125',
            transit: 'THN000000056770/2025'
        };
        
        let db = null;
        let isConnected = false;
        
        // Initialize Firebase
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof firebase === 'undefined') {
                showNotification('Firebase SDK not loaded', 'error');
                return;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyANmru4_kH0eDNgDFURF5aZTaiPgaQ4avU",
                    authDomain: "vipteammod-movies.firebaseapp.com",
                    databaseURL: "https://vipteammod-movies-default-rtdb.firebaseio.com",
                    projectId: "vipteammod-movies",
                    storageBucket: "vipteammod-movies.appspot.com",
                    messagingSenderId: "1024721077525",
                    appId: "1:1024721077525:android:c25e4ab10ec8e4166ad51c"
                };
                
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.database();
                
                // Monitor connection
                const connectedRef = db.ref(".info/connected");
                connectedRef.on("value", (snap) => {
                    isConnected = snap.val() === true;
                    updateStatus(isConnected);
                    
                    if (isConnected) {
                        loadCurrentSettings();
                    }
                });
                
                // Load current settings on connection
                function loadCurrentSettings() {
                    db.ref('systemDefaults').once('value').then(snap => {
                        if (snap.exists()) {
                            const data = snap.val();
                            document.getElementById('input-bulk').value = data.bulkTransit || DEFAULT_VALUES.bulkTransit;
                            document.getElementById('input-security').value = data.security || DEFAULT_VALUES.security;
                            document.getElementById('input-transit').value = data.transit || DEFAULT_VALUES.transit;
                        }
                    });
                    
                    db.ref('systemLocks').once('value').then(snap => {
                        if (snap.exists()) {
                            const data = snap.val();
                            document.getElementById('lock-bulk').checked = !!data.bulkTransit;
                            document.getElementById('lock-security').checked = !!data.security;
                            document.getElementById('lock-transit').checked = !!data.transit;
                        }
                    });
                }
                
            } catch (error) {
                console.error('Firebase error:', error);
                showNotification('Connection error: ' + error.message, 'error');
            }
        });
        
        function updateStatus(connected) {
            const statusBox = document.getElementById('statusBox');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusBox.className = 'status online';
                statusText.textContent = '‚úÖ Connected to server';
            } else {
                statusBox.className = 'status offline';
                statusText.textContent = '‚ùå Disconnected from server';
            }
        }
        
        function saveAllSettings() {
            if (!isConnected) {
                showNotification('Not connected to server', 'error');
                return;
            }
            
            const newValues = {
                bulkTransit: document.getElementById('input-bulk').value.trim(),
                security: document.getElementById('input-security').value.trim(),
                transit: document.getElementById('input-transit').value.trim()
            };
            
            const newLocks = {
                bulkTransit: document.getElementById('lock-bulk').checked,
                security: document.getElementById('lock-security').checked,
                transit: document.getElementById('lock-transit').checked
            };
            
            // Save to Firebase
            db.ref('systemDefaults').set(newValues)
                .then(() => {
                    return db.ref('systemLocks').set(newLocks);
                })
                .then(() => {
                    // Send live update
                    sendLiveUpdate('defaults_updated', newValues);
                    sendLiveUpdate('locks_updated', newLocks);
                    
                    showNotification('Settings saved and broadcasted to all users!', 'success');
                })
                .catch(error => {
                    showNotification('Error saving: ' + error.message, 'error');
                });
        }
        
        function sendLiveUpdate(type, data) {
            if (!db) return;
            
            db.ref('liveUpdates').push({
                type: type,
                data: data,
                timestamp: Date.now(),
                source: 'admin_panel'
            });
        }
        
        function sendTestUpdate() {
            if (!isConnected) {
                showNotification('Not connected', 'error');
                return;
            }
            
            const testData = {
                bulkTransit: 'TEST' + Date.now().toString().slice(-6),
                security: 'TEST' + Date.now().toString().slice(-6),
                transit: 'TEST' + Date.now().toString().slice(-6) + '/2025'
            };
            
            sendLiveUpdate('defaults_updated', testData);
            showNotification('Test update sent to all users', 'success');
        }
        
        function resetToDefault() {
            if (confirm('Reset to default values?')) {
                document.getElementById('input-bulk').value = DEFAULT_VALUES.bulkTransit;
                document.getElementById('input-security').value = DEFAULT_VALUES.security;
                document.getElementById('input-transit').value = DEFAULT_VALUES.transit;
                
                document.getElementById('lock-bulk').checked = true;
                document.getElementById('lock-security').checked = true;
                document.getElementById('lock-transit').checked = true;
                
                showNotification('Reset to defaults (not saved yet)', 'success');
            }
        }
        
        function showNotification(message, type) {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            container.appendChild(notif);
            
            setTimeout(() => {
                notif.style.opacity = '0';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>