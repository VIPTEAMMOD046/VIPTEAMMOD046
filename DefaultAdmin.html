<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Locking System Admin</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 500px;
        }
        
        h1 { color: #333; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #666; margin-bottom: 30px; text-align: center; font-size: 14px; }
        
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 25px; 
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .online { background: #e8f5e9; color: #2e7d32; }
        .offline { background: #ffebee; color: #c62828; }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-dot.online { background: #4caf50; }
        .status-dot.offline { background: #f44336; }
        
        .lock-section { 
            background: #f9f9f9; 
            padding: 25px; 
            border-radius: 8px; 
            margin-bottom: 25px;
        }
        
        .lock-group { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px; 
            margin-bottom: 10px; 
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .lock-label {
            font-weight: 500;
            color: #333;
        }
        
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 50px; 
            height: 26px; 
        }
        
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #ccc; 
            transition: .4s; 
            border-radius: 34px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 18px; 
            width: 18px; 
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }
        
        input:checked + .slider { 
            background-color: #4caf50; 
        }
        
        input:checked + .slider:before { 
            transform: translateX(24px); 
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 14px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-save {
            background: #2196f3;
            color: white;
        }
        
        .btn-save:hover {
            background: #1976d2;
        }
        
        .btn-lock-all {
            background: #ff9800;
            color: white;
        }
        
        .btn-lock-all:hover {
            background: #f57c00;
        }
        
        .btn-unlock-all {
            background: #4caf50;
            color: white;
        }
        
        .btn-unlock-all:hover {
            background: #388e3c;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .success { background: #4caf50; }
        .error { background: #f44336; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Field Locking System</h1>
        <p class="subtitle">Lock/unlock form fields for all users</p>
        
        <div class="status offline" id="statusBox">
            <div class="status-dot offline" id="statusDot"></div>
            <span id="statusText">Connecting...</span>
        </div>
        
        <div class="lock-section">
            <h3 style="margin-bottom: 20px; color: #555;">Field Controls</h3>
            
            <div class="lock-group">
                <span class="lock-label">Bulk Transit Pass No</span>
                <label class="switch">
                    <input type="checkbox" id="lock-bulk">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="lock-group">
                <span class="lock-label">Security Paper Serial No</span>
                <label class="switch">
                    <input type="checkbox" id="lock-security">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="lock-group">
                <span class="lock-label">Transit Pass Serial No</span>
                <label class="switch">
                    <input type="checkbox" id="lock-transit">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-unlock-all" onclick="unlockAll()">
                üîì Unlock All
            </button>
            <button class="btn-lock-all" onclick="lockAll()">
                üîí Lock All
            </button>
        </div>
        
        <button class="btn-save" onclick="saveLocks()" style="margin-top: 15px;">
            üíæ Save & Broadcast
        </button>
    </div>
    
    <div id="notificationContainer"></div>
    
    <script>
        let db = null;
        let isConnected = false;
        
        // Initialize Firebase
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof firebase === 'undefined') {
                showNotification('Firebase not loaded', 'error');
                return;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyANmru4_kH0eDNgDFURF5aZTaiPgaQ4avU",
                    authDomain: "vipteammod-movies.firebaseapp.com",
                    databaseURL: "https://vipteammod-movies-default-rtdb.firebaseio.com",
                    projectId: "vipteammod-movies",
                    storageBucket: "vipteammod-movies.appspot.com",
                    messagingSenderId: "1024721077525",
                    appId: "1:1024721077525:android:c25e4ab10ec8e4166ad51c"
                };
                
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.database();
                
                // Monitor connection
                const connectedRef = db.ref(".info/connected");
                connectedRef.on("value", (snap) => {
                    isConnected = snap.val() === true;
                    updateStatus(isConnected);
                    
                    if (isConnected) {
                        loadCurrentLocks();
                    }
                });
                
                // Load current locks
                function loadCurrentLocks() {
                    db.ref('systemLocks').once('value').then(snap => {
                        if (snap.exists()) {
                            const data = snap.val();
                            document.getElementById('lock-bulk').checked = !!data.bulkTransit;
                            document.getElementById('lock-security').checked = !!data.security;
                            document.getElementById('lock-transit').checked = !!data.transit;
                        }
                    }).catch(err => {
                        console.error('Error loading locks:', err);
                    });
                }
                
            } catch (error) {
                console.error('Firebase error:', error);
                showNotification('Connection error', 'error');
            }
        });
        
        function updateStatus(connected) {
            const statusBox = document.getElementById('statusBox');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusBox.className = 'status online';
                statusDot.className = 'status-dot online';
                statusText.textContent = 'Connected to server';
            } else {
                statusBox.className = 'status offline';
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'Disconnected from server';
            }
        }
        
        function saveLocks() {
            if (!isConnected) {
                showNotification('Not connected to server', 'error');
                return;
            }
            
            const newLocks = {
                bulkTransit: document.getElementById('lock-bulk').checked,
                security: document.getElementById('lock-security').checked,
                transit: document.getElementById('lock-transit').checked
            };
            
            db.ref('systemLocks').set(newLocks)
                .then(() => {
                    // Send live update
                    sendLiveUpdate('locks_updated', newLocks);
                    showNotification('Field locks updated for all users', 'success');
                })
                .catch(err => {
                    showNotification('Error saving: ' + err.message, 'error');
                });
        }
        
        function sendLiveUpdate(type, data) {
            if (!db) return;
            
            db.ref('liveUpdates').push({
                type: type,
                data: data,
                timestamp: Date.now(),
                source: 'admin_panel'
            });
        }
        
        function lockAll() {
            document.getElementById('lock-bulk').checked = true;
            document.getElementById('lock-security').checked = true;
            document.getElementById('lock-transit').checked = true;
            showNotification('All fields set to locked', 'success');
        }
        
        function unlockAll() {
            document.getElementById('lock-bulk').checked = false;
            document.getElementById('lock-security').checked = false;
            document.getElementById('lock-transit').checked = false;
            showNotification('All fields set to unlocked', 'success');
        }
        
        function showNotification(message, type) {
            const container = document.getElementById('notificationContainer');
            
            // Remove existing notifications
            container.innerHTML = '';
            
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${message}</span>
            `;
            container.appendChild(notif);
            
            setTimeout(() => {
                notif.style.opacity = '0';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>